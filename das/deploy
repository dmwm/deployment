# vim: set ft=sh sw=2 ts=8 et :
deploy_das_deps()
{
  deploy backend
  deploy wmcore-auth
  deploy mongodb
  deploy admin
}

deploy_das_prep()
{
  mkproj
  mkproxy
}

deploy_das_sw()
{
  deploy_pkg comp cms+das
  perl -p -i -e "s|{ROOT}|$root|" $project_config/analytics_cfg.py
}

deploy_das_post()
{
  case $host in vocms34 | vocms13[2689] | vocms16[13] ) disable ;; * ) enable ;; esac

  # make sure  staging dir exists with right permissions
  local mongodb_stage="$root/state/das/mongodb_staging"
  mkdir -p "$mongodb_stage"
  sudo chown -Rf _das:_das "$mongodb_stage"

  # stage the database updates
  sudo -H -u _das bashs -l -c "${project_config}/manage resetdata"  # output goes to stdin/deploy log

  ( mkcrontab; sysboot; ) | crontab -
}
