# vim: set ft=sh sw=2 ts=8 et :
deploy_das_deps()
{
  deploy backend
  deploy wmcore-auth
  deploy mongodb
  deploy admin
}

deploy_das_prep()
{
  mkproj
  mkproxy
}

deploy_das_sw()
{
  deploy_pkg comp cms+das
  perl -p -i -e "s|{ROOT}|$root|" $project_config/analytics_cfg.py
}

deploy_das_post()
{
  case $host in vocms34 | vocms13[2689] | vocms16[13] ) disable ;; * ) enable ;; esac
  (mkcrontab; sysboot) | crontab -

  # TODO: this is probably not needed anymore as we get maps from URL
  case $host in vocms132 ) tbed="_testbed";; * ) tbed="" ;; esac
  cp $root/current/apps/das/lib/python2.6/site-packages/DAS/services/cms_maps/das${tbed}_maps.js \
    $mongodb_stage/update_mapping_db.js

  # initialize whoosh IR index for keyword search
  # this dir has to be writable by DAS if it will be initialized from DAS
  local kws_index_dir=root/state/das/kws_index
  rm -Rf $kws_index_dir
  mkdir -p $kws_index_dir
  chown _das:_das $kws_index_dir
}
